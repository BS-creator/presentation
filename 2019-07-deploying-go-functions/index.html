<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Deploying Go Functions</title>

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/moon.css">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>
  <!-- <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet"> -->
</head>

<body>
  <div class="reveal">
    <div class="slides">
<section data-transition='concave' data-state='blackout'>
  <h1>DEPLOYING GO FUNCTIONS</h1>
</section>

<section>
  <h2>Why deploying go functions ?</h2>
</section>

<section>
  <h2>Mental limitations</h2>
  <br>
  <ul>
    <li># decisions / day </li>
    <li># things to remember</li>
    <li>speed of memory / reflexes</li>
  </ul>
</section>
<section>
  <h2>Demo</h2>
  <p>
    <a href="https://www.openfaas.com/">
      <img width="50%" src="https://github.com/openfaas/media/blob/master/OpenFaaS_Magnet_3_1_png.png?raw=true"
        alt="openfaas logo">
    </a>
  </p>
  <pre><code class="hljs bash" data-trim>
git clone https://github.com/openfaas/faas
cd faas
make start_kind
</code></pre>
</section>
<section>
  <ul>
    <li>demo</li>
    <li>show code</li>
    <li>show how it is build (architecture)</li>
    <li>build is ok but time consuming</li>
    <li>buy (use open source) and learn is a better strategy/investment long term</li>
    <li>show with linkerd (https://github.com/openfaas-incubator/openfaas-linkerd2)</li>
    <li>show "no code"</li>
    <li>show talk "simplicity is complicated"</li>
    <li>serverless (mindset/architecture)vs FaaS (implementations)</li>
    <li>on prem vs pay for what you use</li>
    <li>employee time (build) vs using a product (buy)</li>
    <li>show Swardley map</li>
    <li>deploy to gcp</li>
    <li>talk about security and ci/cd</li>
    <li>show cloud architecture forseti-viz</li>

  </ul>
</section>
<section>
  Shift left
  early in dev stage (config as code, open policy agent)
  or in prod for what cannot be shifted left (chaos engineering, load testing, ...)

  the state of a ci/cd. A pipeline is an application of its own.


  TODO:
  * graph for ci cd
  * install linkerd with openfaas
  * deploy a function,
  * deploy on cloud run:
  https://github.com/GoogleCloudPlatform/cloud-run-events/blob/master/docs/install/README.md
  * Use run on cloud run: https://github.com/GoogleCloudPlatform/cloud-run-button
  * cloud run sample https://github.com/GoogleCloudPlatform/cloud-run-samples/blob/master/go/pubsub/main.go


  https://github.com/GoogleCloudPlatform/cloud-functions-go
  git clone https://github.com/GoogleCloudPlatform/golang-samples.git
  https://cloud.google.com/functions/docs/quickstart#functions-prepare-environment-go
</section>
<section>
  <h2>How does it work</h2>
  <ul>
    <li>OpenFaas API Gateway routes into functions</li>
    <li>Runs inside a container</li>
    <li>Uses a watchdog process (web server)</li>
    <li>Process STDIN and returns to STDOUT</li>
    <li>Collects metrics in Prometheus</li>
  </ul>
</section>
<section>
  <h4>templates</h4>
  <pre><code class="hljs golang" data-trim >
import (
"fmt"
"io/ioutil"
"log"
"os"

"handler/function"
)
func main() {
input, err := ioutil.ReadAll(os.Stdin)
if err != nil {
log.Fatalf("Unable to read standard input: %s", err.Error())
}
fmt.Println(function.Handle(input))
}
</code></pre>
  <p><a href="https://github.com/openfaas/templates">See all templates</a></p>
</section>

<section>
  <h4>functions</h4>
  <pre><code  class="hljs golang" data-trim>
// Handle a serverless request
func Handle(req []byte) string {
return fmt.Sprintf("Hello, Go. You said: %s", string(req))
}
</code></pre>
  <p><a href="https://github.com/esimov/pigo-openfaas/blob/master/pigo-openfaas/handler.go">face detection
      handler</a></p>
</section>

<section>
  <pre><code class="hljs dockerfile" data-trim>
# Populate example here - i.e. "cat", "sha512sum" or "node index.js"
ENV fprocess="./handler"
# Set to true to see request in function logs
ENV write_debug="false"

EXPOSE 8080

HEALTHCHECK --interval=3s CMD [ -e /tmp/.lock ] || exit 1
CMD [ "fwatchdog" ]
  </code></pre>
</section>

<!-- <section>
Each container has a watchdog process that hosts a web server allowing a post request
to be forwarded to a desired process via STDIN.
The response is sent back to the caller via STDOUT.

The API Gateway provides an external route into your functions and collects metrics in Prometheus.
The gateway will scale functions according to demand by mangaging Docker Swarm replicas as throughput increases.
A UI is baked in allowing you to invoke functions in your browser and create new ones as needed.
</section> -->

<section>
  <h2>Why deploying go functions ?</h2>
</section>
<section>
  <h1>We could build it</h1>
  <h2>BUT</h2>
  <h4>spending time on the business makes more sense financially.</h4>
</section>
<section>
  <h3>build OR buy</h3>
  <img width="60%" src="tweetdc.png" alt="Tweet about datacenter" />
  <p>
    <a
      target="_blank"
      href="https://threadreaderapp.com/thread/1102401615263223809.html"
      >whole thread</a
    >
  </p>
</section>
<section>
  <h3>build OR buy</h3>
  <p>Restaurants buy, cook and sell food.</p>
  <p>Very few do farming and even less are good at both.</p>
</section>
<section>
  <h2>Mental limitations</h2>
  <br>
  <ul>
    <li># decisions / day </li>
    <li># things to remember</li>
    <li>speed of memory / reflexes</li>
  </ul>
</section>
<section>
  <h2>Consistency is key</h2>
  <img
    src="army_report_title.png"
    alt="Archives of the History of American Psychology, The Center for the
  History of Psychology, The University of Akron"
    srcset=""
  />
  <img src="army_report.png" alt="army report uniformity" srcset="" />
</section>
<section>
  <ul>
    <li>Logging</li>
    <li>Tracing</li>
    <li>Metrics</li>
    <li>Service identity and Auth</li>
    <li>Circuit breaking</li>
    <li>Traffic flow and policies</li>
    <li>Failover</li>
    <li>A/B testing</li>
    <li>Fault injection</li>
    <li>...</li>
  </ul>
  <br>
  <br>
  <h4 class="fragment">‚û°Ô∏è Ô∏è use code?</h4>
</section>
<section>
  <h3>drawbacks</h3>
  <ul>
    <li>combination language/framework/version/feature</li>
    <li>maintain, upgrade, migrate, retire</li>
    <li>code pollution and complexity (+ testing)</li>
    <li>deployment / rolling update</li>
    <li>language/framework/version lock-in</li>
    <li>debugging</li>
  </ul>
  <br>
  <br>
  <h4 class="fragment">‚û°Ô∏è Ô∏è move it to the infrastructure</h4>
</section>
<section>
  <img src="/no-code.png" alt="no code" width="80%">
  <a target="_blank" href="https://github.com/kelseyhightower/nocode">repository</a>
</section>

<section>
  <h2>CODE</h2>
  üëá
  <h2>INFRA</h2>
  üëá
  <H2>SERVICE</H2>
</section>

<section>
  <h2>Why deploying go functions ?</h2>
</section>
<section>
  <h2>Simplicity is complicated</h2>
  <h4>Rob Pike</h4>
  <div>
    <img src="https://upload.wikimedia.org/wikipedia/en/7/76/The_Art_of_Unix_Programming.jpg"
      alt="The Art of UNIX programming">
      <p><a href="https://www.youtube.com/watch?v=rFejpH_tAHM">dotGo 2015 - Rob Pike - Simplicity is Complicated</a></p>
  </div>
</section>

<section>
  <h2>From serverless to Service Full</h2>
  <h4> by Patrick Debois </h4>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/bYCPbKHivMA" frameborder="0"
    allow="autoplay; encrypted-media" allowfullscreen></iframe>
  <!-- https://www.youtube.com/watch?v=bYCPbKHivMA -->
</section>

<section>
  <h3> Name a service for :</h3>
  <ul>
    <li>mails</li>
    <li>chat</li>
    <li>pictures</li>
    <li>files</li>
    <li>code</li>
    <li>dns</li>
    <li>payment</li>
  </ul>
</section>

<section>
  <h2>tradeoffs</h2>
  <ul>
    <li>On premise: fixed price and capacity</li>
    <li>Cloud: pay for what you use</li>
  </ul>
  <ul>
    <li>Developer time (build)</li>
    <li>Use a product (buy) </li>
  </ul>
</section>

<section>
  <img src="https://cdn-images-1.medium.com/max/1600/1*9UXhn8Ne74Ijfn931sjOPw.jpeg" alt="mapping">
  <p><a href="https://youtu.be/xlNYYy8pzB4">Simon Wardly - Mapping</a></p>
</section>
  

<!-- <section>
Even though we could build it,
spending my time on the business makes more sense financially.


Service are limited

No maintenance  but services are out of your control sometimes

Dependency!

Promise theory
Chaos Engineering

</section> -->


<section>
  <h2>THANK YOU</h2>
  <br>
  <p>
    <small>
      <a style='font-weight:bold;color:deepskyblue;' href='http://github.com/veggiemonk'>Github: @veggiemonk</a>
      <br />
      <a style='font-weight:bold;color:deepskyblue;' href='https://twitter.com/veggiemonk'>Twitter:
        @veggiemonk</a>
      <br />
      <a style='font-weight:bold;color:deepskyblue;' href='https://www.linkedin.com/in/julienbisconti/'>LinkedIn:
        julienbisconti</a>
      <br />
      <a style='font-weight:bold;color:deepskyblue;' href="https://veggiemonk.github.io/">blog:
        https://veggiemonk.github.io/</a>
      <br />
      <a style='font-weight:bold;color:deepskyblue;' href="https://www.slideshare.net/julienbisconti">slides:
        https://www.slideshare.net/julienbisconti</a>
    </small>
  </p>
</section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>

  <script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
      controls: true,
      progress: true,
      center: true,
      hash: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom
      dependencies: [
        { src: 'plugin/markdown/marked.js' },
        { src: 'plugin/markdown/markdown.js' },
        { src: 'plugin/notes/notes.js', async: true },
        { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
      ]
    });
  </script>
</body>

</html>